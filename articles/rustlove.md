---
published: true
type: idea
topics:
  - Rust
emoji: ğŸŒ€
title: ã€ŒRustãŒå«Œã„ã§ã™ã€‚ã€ã®æ„Ÿæƒ³
---
https://zenn.dev/miguel/articles/f052de93fc9980

ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§1Rustãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦æ€ã£ãŸã“ã¨ã‚’æ›¸ã„ãŸã€‚
# å…¨ä½“ã‚’é€šã—ã¦
- WASMå›ºæœ‰ã®å•é¡Œã«ãƒãƒã£ã¦ã—ã¾ã£ã¦ã„ã‚‹
- Rustã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¨€èªã¨åŒã˜æ ã§è¦‹ã¦ã—ã¾ã£ã¦ã„ã‚‹
ã®2ç‚¹ãŒè¾›ã•ã®åŸå› ã§ã‚ã‚‹ã¨æ„Ÿã˜ãŸã€‚

å‰è€…ã«ã¤ã„ã¦ã€ã“ã®æ–¹ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«Rustã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã ãŒã“ã“ã¯ç¢ºã‹ã«æ•´å‚™ãŒè¡Œãå±Šã„ã¦ãªã„åˆ†é‡ã§WASMç‰¹æœ‰ã®å•é¡Œã¨JSã¨ã®FFIã®è¾›ã•ãŒã‚‚ã‚ã«æ„Ÿã˜ã‚‰ã‚Œã¦è¾›ã„ã¨æ€ã†ã€‚
å‰²ã¨ãªã‚“ã§ã‚‚ã‹ã‚“ã§ã‚‚Rustã‚’ä½¿ã†è‡ªåˆ†ã§ã‚ã£ã¦ã‚‚Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã¯ãŠã¨ãªã—ãTSã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

å¾Œè€…ã«ã¤ã„ã¦ã€ã“ã®è¨˜äº‹ã§ã¯å…¨ä½“çš„ã«ã€ŒJSã‚„Pythonã§ã¯ã“ã‚“ãªã«ç°¡å˜ã ã£ãŸã®ã«Rustã§ã¯é›£ã—ã„/ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€ã¨ã„ã†è©•ä¾¡ãŒå¤šã„ãŒã€ã“ã‚Œã¯å¾Œè¿°ã™ã‚‹ã‚ˆã†ã«RustãŒæä¾›ã™ã‚‹ã‚‚ã®ã¨æœŸå¾…ã®ãšã‚ŒãŒåŸå› ã ã¨æ„Ÿã˜ãŸã€‚
# å„ç¯€ã«ã¤ã„ã¦
## 1
ã€Œæ‰€æœ‰æ¨©ã®æ¦‚å¿µã‚’ç†è§£ã™ã‚Œã°ã€ã‚ã¨ã¯ç°¡å˜ã§ã™ã€ã¯äº‹å®Ÿã‹ã‚‚çŸ¥ã‚Œãªã„ãŒãã“ã«è¡Œãç€ãã®ã¯ã‹ãªã‚Šé›£ã—ã„ã¨æ€ã†ã€‚(è‡ªåˆ†ã‚‚ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã‚¨ãƒ©ãƒ¼ã§è‹¦ã—ã‚€ã“ã¨ã¯ã‚ˆãã‚ã‚‹)

1.1ã«ã¤ã„ã¦ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«æŒ‡æ‘˜ãŒã‚ã‚‹é€šã‚Šleakã‚’ä½¿ã‚ãšStringã‚’å…¥ã‚Œã‚Œã°ã‚ˆã„ã¨æ€ã†ã€‚
1.2ã¯å‘¨ã‚Šã®ã‚³ãƒ¼ãƒ‰ã‚’ã¡ã‚ƒã‚“ã¨è¦‹ã¦ã¿ãªã„ã¨ãªã‚“ã¨ã‚‚è¨€ãˆãªã„ãŒãã‚Œã“ãæ‰€æœ‰æ¨©ã‚’ç†è§£ã—ã¦ã„ã‚Œã°ãã“ã¾ã§è‹¦åŠ´ã¯ã—ãªã„ã¯ãšã€‚
## 2
Cargoã®featureã‚·ã‚¹ãƒ†ãƒ ãŒåˆ†ã‹ã‚Šã¥ã‚‰ã„ã¨ã„ã†ã®ã¯æ­£å½“ãªæ‰¹åˆ¤ã ã¨æ€ã†ã€‚è‡ªåˆ†ã¯æœ€è¿‘çµ„ã¿è¾¼ã¿å‘ã‘Rustã‚’å¼„ã£ã¦ã„ã‚‹ãŒfeatureãŒæ»…èŒ¶è‹¦èŒ¶ã«ãªã‚‹ã“ã¨ã¯ã‚ˆãã‚ã‚‹ã€‚
2.1ã®cfgã¾ã¿ã‚Œã«ã¤ã„ã¦ã¯traitã‚’ä½¿ã†ã“ã¨ã§è»½æ¸›ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŒå‹ã‚·ã‚¹ãƒ†ãƒ ã®è¡¨ç¾åŠ›ä¸è¶³ã‚„å®šç¾©ã®ç…©é›‘ã•ã‚†ãˆã«ã«cfgã‚’ä½¿ã†ã“ã¨ã‚‚å¤šã„ã€‚ã“ã‚Œã¯ã‚ã‚‹ç¨‹åº¦ä»•æ–¹ã®ãªã„ã“ã¨ã‹ãªã¨æ€ã†ã€‚ã¾ãŸJSã¨é•ã„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«é©åˆã—ãªã„ã‚³ãƒ¼ãƒ‰ã¯å¤§æŠµã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‰ã§ããªã„ã®ã§å®Ÿè¡Œæ™‚ã®åˆ†å²ã¯å›°é›£ã€‚
## 3
3.1ã®å•é¡Œã¯è‡ªåˆ†ã‚‚ã“ã®ã‚¨ãƒ©ãƒ¼ã«å‡ºä¼šã£ãŸã“ã¨ãŒã‚ã‚Šã€ç¢ºã‹ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒä¸è¶³æ°—å‘³ã ã£ãŸè¨˜æ†¶ãŒã‚ã‚‹ã€‚ãŸã ã€Œæº–å¿…é ˆãƒ„ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ã“ã¨ãŒæ—¥å¸¸èŒ¶é£¯äº‹ã€ã ã¨ã¯æ€ã‚ãªã„ã€‚
3.2ã«ã¤ã„ã¦ã¯ãã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å•é¡Œã ã¨æ€ã†ã€‚
## 4
ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚é–“ã®é…ã•ã«ã¤ã„ã¦ã¯ãã®é€šã‚Šã§ã€ã“ã‚Œã¯ãŸã³ãŸã³Rustã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã‚‚è©±é¡Œã«ãªã£ã¦ã„ã‚‹ã€‚ãŸã ã€Œé–‹ç™ºç’°å¢ƒã§ã‚‚å‹•ãã“ã¨ã‚’ç¥ˆã£ã¦æ›¸ã„ãŸå‘ªæ–‡ã€ãŒã“ã®`.cargo/config.toml`ãªã®ã¯è§£ã›ãªã„æ„Ÿã˜ã¯ã‚ã‚‹ã€‚ã“ã®configã ã¨ãƒ“ãƒ«ãƒ‰ã¯é€šå¸¸ã‚ˆã‚Šã•ã‚‰ã«é…ããªã‚‹ã ã‚ã†(ãŸã ã—è‰¯ã„ãƒã‚¤ãƒŠãƒªãŒã§ãã‚‹)ã€‚
4.2ã«ã¤ã„ã¦ã¯ã“ã®ã‚ˆã†ãªäº‹ä¾‹ã«å½“ãŸã£ãŸã“ã¨ãŒãªã„ã®ã§ã‚ˆãã‚ã‹ã‚‰ãªã„ã€‚
## 5
Rustã§ã‚‚æ„å‘³ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã“ã¨ã¯ç¢ºã‹ã«ã‚ã‚‹ãŒã“ã®ä¾‹ã§ç¤ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã¯ã€ŒCopyãƒˆãƒ¬ã‚¤ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„å€¤ãŒmoveã•ã‚ŒãŸ â†’ ãªã®ã§ãã®å€¤ã¯ã‚‚ã†borrowã§ãã¾ã›ã‚“ã‚ˆã€ã¨æ˜ç¢ºã«ç¤ºã—ã¦ãŠã‚Šç‰¹ã«å†—é•·ã§ã‚ã‚‹ã¨ã¯æ„Ÿã˜ãªã„ã€‚
## 6
ã“ã‚Œã¯ç¢ºã‹ã«æœ€åˆè¦‹ã‚Œã°ã‚²ãƒƒã¨ãªã‚Šãã†ã€‚ã“ã†ã„ã†å ´åˆã¯logã‚¯ãƒ¬ãƒ¼ãƒˆã¨wasm-loggerãªã©å¤–éƒ¨ã‚¯ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†äº‹ãŒå¤šã„ã¨æ€ã†ã€‚ç¾åœ¨Rustã®wasmã‚¿ãƒ¼ã‚²ãƒƒãƒˆã¯ãƒ–ãƒ©ã‚¦ã‚¶å‘ã‘ã§ã‚ã‚‹ã¨ã¯å®šã¾ã£ã¦ã„ãªã„ãŸã‚stdã®printã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã«å‡ºåŠ›ã¨ã„ã£ãŸã‚ˆã†ãªã“ã¨ã¯ã§ããªã„ã€‚ãã†ã„ã†ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’è¿½åŠ ã™ã¹ãã‹ã©ã†ã‹ã«ã¤ã„ã¦ã¯æ„è¦‹ãŒåˆ†ã‹ã‚Œã‚‹ã¨ã“ã‚ã‹ã‚‚ã—ã‚Œãªã„ã€‚

ãŸã é€šå¸¸ã®Rustã§ã¯`println!`ã‚„`dbg!`ãŒã‚ã‚‹ã®ã«wasmã®äº‹ä¾‹ã‚’ã‚‚ã£ã¦ã€Œãƒ‡ãƒãƒƒã‚°=è‹¦è¡Œã€ã¨ã„ã†ã®ã¯è¨€ã„ã™ãã§ã¯ãªã„ã‹ã¨ã¯æ€ã†ã€‚
# æ„Ÿæƒ³
wasmé–¢é€£ã‚„ãƒ“ãƒ«ãƒ‰ãŒé…ã„ã“ã¨ã«ã¤ã„ã¦ã¯è‡ªåˆ†ã‚‚å…±æ„Ÿã§ãã‚‹éƒ¨åˆ†ãŒå¤šã‹ã£ãŸãŒã€ä»–ã®éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã“ã®è¨˜äº‹ã®ç­†è€…ãŒæœŸå¾…ã—ã¦ã„ã‚‹ã‚‚ã®ã¨RustãŒæä¾›ã™ã‚‹ã‚‚ã®ã«ã‚ºãƒ¬ãŒã‚ã‚‹ã‹ã‚‰ã“ã†ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã¯ãªã„ã‹ã¨æ„Ÿã˜ãŸã€‚
RustãŒå­˜åœ¨ã™ã‚‹èƒŒæ™¯ã€ãƒ¡ãƒ¢ãƒªç®¡ç†ã«ã¤ã„ã¦ç†è§£ã™ã‚‹ã¨ã“ã®è¨˜äº‹ã§å‡ºã‚‹ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦ã‚‚ã‚ã‚‹ç¨‹åº¦ç´å¾—ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã†ã€‚

ã€Œãƒ¡ãƒ¢ãƒªç®¡ç†ã‚’å®‰å…¨ã‹ã¤åŠ¹ç‡çš„ã«è¡Œã†ã€ã€Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«ã§ãã‚‹ã ã‘å¤šãã®ã‚¨ãƒ©ãƒ¼ã‚’æ¤œçŸ¥ã—ã€æ­£ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ã›ã‚‹ã€ãŒRustã«ã¨ã£ã¦ã®æœ€é‡è¦èª²é¡Œã ãŒã€Rustã§ã¯ãã‚Œã‚‰ã‚’é”æˆã™ã‚‹ãŸã‚ã«ã„ãã¤ã‹ã®æ·ãŒã¯ã‚ã‚‰ã‚Œã¦ãŠã‚Šã€ç‰¹ã«ä¸€ã¤ç›®ã®ç›®æ¨™ã‚’é”æˆã™ã‚‹ãŸã‚ã®ã‚‚ã®ãŒæ‰€æœ‰æ¨©ã‚„ãƒ©ã‚¤ãƒ•ã‚¿ã‚¤ãƒ ã§ã‚ã‚‹ã€‚

ãŸã ã—é«˜ãƒ¬ã‚¤ãƒ¤ã§ã¯å¿…ãšã—ã‚‚RustãŒæä¾›ã™ã‚‹GCãªã—ã®ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ãŒå¿…è¦ãªã‚ã‘ã§ã¯ãªã„ã€‚
è‡ªåˆ†ã¯ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§ä»¥å¤–ã«ã‚‚Rustã®é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã•ã€è±Šå¯Œãªå‹ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹é–“é•ã„ã®çŠ¯ã—ã«ãã•ã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®è±Šå¯Œã•ã‚’é­…åŠ›ã ã¨æ„Ÿã˜ã¦é€šå¸¸ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãªã©æ¯”è¼ƒçš„é«˜ã„ãƒ¬ã‚¤ãƒ¤ã«ãŠã„ã¦ã‚‚Rustã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚
ãã†è€ƒãˆã¦ã„ã‚‹ã®ã¯è‡ªåˆ†ã ã‘ã¨ã„ã†ã‚ã‘ã§ã¯ãªãã€ã ã‹ã‚‰ã“ãæœ€è¿‘ã§ã¯Rustã¯Webã‚µãƒ¼ãƒã‚„æœã¦ã¯Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚ˆã†ãªé«˜ãƒ¬ã‚¤ãƒ¤ã«ã‚‚é€²å‡ºã—ã¦ã„ã‚‹ã€‚

ã—ã‹ã—Rustã‚’ã€Œãªã‚“ã‹æ€§èƒ½ã®é«˜ã„è¨€èªã€ã¨æ€ã£ã¦ä½¿ã†ã¨Rustã«ã‚ˆã‚Šèª²ã•ã‚Œã‚‹åˆ¶é™ãŒãŸã ãŸã é¬±é™¶ã—ã„ã‚‚ã®ã¨æ„Ÿã˜ã¦ã—ã¾ã†ã ã‚ã†ã€‚
é«˜ãƒ¬ã‚¤ãƒ¤ã§ã‚‚ä½¿ãˆã‚‹ã¨ã¯è¨€ãˆRustã¯Cã‚„C++ãªã©ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã¨åŒç¨®ã®ã‚‚ã®ã§ã‚ã‚Šã€JSã‚„Pythonã¨ã¯é•ã†å•é¡Œã‚’è§£æ±ºã—ã‚ˆã†ã¨ã—ã¦ç”Ÿã¾ã‚ŒãŸã¨ã„ã†ã“ã¨ã‚’å¿µé ­ã«å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã†ã€‚



> ã“ã®è¨˜äº‹ã¯ [https://note.nazo6.dev/blog/rustlove](https://note.nazo6.dev/blog/rustlove) ã¨ã®ã‚¯ãƒ­ã‚¹ãƒã‚¹ãƒˆã§ã™ã€‚