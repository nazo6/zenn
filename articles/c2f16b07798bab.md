---
published: true
type: idea
topics:
  - lua
  - neovim
  - lsp
emoji: ğŸ“„
title: Neovim builtin LSPè¨­å®šå…¥é–€
---


# ã¯ã˜ã‚ã«

Neovim ã«ã¯çµ„ã¿è¾¼ã¿ã®[LSP](https://microsoft.github.io/language-server-protocol/)ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã‚ã‚Šã¾ã™ã€‚å°‘ã—å‰ã¾ã§ã¯ VSCode ä¸¦ã®é–‹ç™ºä½“é¨“ã‚’å¾—ã‚‹ãŸã‚ã«ã¯`coc.nvim`ã‚’ä½¿ã†ã®ãŒãƒ™ã‚¹ãƒˆãªé¸æŠè‚¢ã§ã—ãŸãŒã€neovim builtin lsp(ä»¥ä¸‹ nvim-lsp)ã§ã‚‚ã‹ãªã‚Šã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ãŒæ•´å‚™ã•ã‚Œã¦ãŠã‚Šã€VSCode ä¸¦ã®é–‹ç™ºä½“é¨“ãŒå¾—ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ãã‚“ãª nvim-lsp ã®è¨­å®šã®åŸºæœ¬çš„ãªã¨ã“ã‚ã‚’èª¬æ˜ã—ã¾ã™ã€‚

# ç’°å¢ƒ

- Windows ã§ã‚‚ MacOS ã§ã‚‚ Linux ã§ã‚‚å‹•ãã¯ãšã§ã™ã€‚
- Neovim stable æœ€æ–°ç‰ˆã‚‚ã—ãã¯ nightly
- git ã‚³ãƒãƒ³ãƒ‰
- ãã®ä»– Mason ã‹ã‚‰è‰²ã€…ãªç‰©ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ã†éš›ã«ã¯`:checkhealth mason`ã§æŒ‡å®šã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãŒå¿…è¦ã¨ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

# åŸºæœ¬çš„ãªè¨­å®š

## å¿…é ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç³»

nvim-lsp ã¯çµ„ã¿è¾¼ã¿ã§ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ãã®ã¾ã¾ã ã¨æ‰±ã„ã¥ã‚‰ã„ãŸã‚ä»¥ä¸‹ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½¿ç”¨ã•ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚

- nvim-lspconfig (https://github.com/neovim/nvim-lspconfig)
- mason.nvim (https://github.com/williamboman/mason.nvim)
- mason-lspconfig.nvim (https://github.com/williamboman/mason-lspconfig.nvim)

ã¾ãšã€å„è¨€èªç”¨ã®è¨­å®šã‚’æä¾›ã™ã‚‹[nvim-lspconfig](https://github.com/neovim/nvim-lspconfig)ã§ã™ã€‚neovim ã®å…¬å¼ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚LSP ãƒ—ãƒ­ãƒˆã‚³ãƒ«è‡ªä½“ã¯ã©ã®è¨€èªã§ã‚‚å…±é€šã§ã™ãŒ LSP ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚„ã©ã†ã„ã†å ´åˆã«ã©ã®è¨€èªã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã•ã›ã‚‹ã¹ãã‹(ä¾‹ãˆã°`package.json`ãŒã‚ã‚‹å ´åˆã¯ Typescript ã®è¨€èªã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã»ã—ã„ãªã©)ã¯ãã‚Œãã‚Œé•ã†ã®ã§ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚

æ¬¡ã« mason.nvim ã§ã™ãŒã€ã“ã‚Œã¯æ§˜ã€…ãªå¤–éƒ¨ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ neovim å†…ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚ãã—ã¦ mason-lspconfig ã¯ mason.nvim ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ LSP ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ã†ãŸã‚ã«å¿…è¦ã§ã™ã€‚

Neovimç•Œã§æœ€ã‚‚äººæ°—ã§ã‚ã‚ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã®[lazy.nvim](https://github.com/folke/lazy.nvim)ã‚’ä½¿ã£ãŸè¨­å®šä¾‹ãŒä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚
```lua init.lua
-- lazy.nvimã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
local lazypath = vim.fn.stdpath "data" .. "/lazy/lazy.nvim"
if not vim.loop.fs_stat(lazypath) then
  vim.fn.system {
    "git",
    "clone",
    "--filter=blob:none",
    "--single-branch",
    "https://github.com/folke/lazy.nvim.git",
    lazypath,
  }
end
vim.opt.runtimepath:prepend(lazypath)

-- lazy.nvimã‚’ä½¿ã£ã¦ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
require("lazy").setup({
  { "neovim/nvim-lspconfig" },
  { "williamboman/mason.nvim" },
  { "williamboman/mason-lspconfig.nvim" },
}, {})

-- LSPã‚µãƒ¼ãƒã‚¢ã‚¿ãƒƒãƒæ™‚ã®å‡¦ç†
vim.api.nvim_create_autocmd("LspAttach", {
  callback = function(ctx)
    local set = vim.keymap.set
    set("n", "gD", "<cmd>lua vim.lsp.buf.declaration()<CR>", { buffer = true })
    set("n", "gd", "<cmd>lua vim.lsp.buf.definition()<CR>", { buffer = true })
    set("n", "K", "<cmd>lua vim.lsp.buf.hover()<CR>", { buffer = true })
    set("n", "gi", "<cmd>lua vim.lsp.buf.implementation()<CR>", { buffer = true })
    set("n", "<C-k>", "<cmd>lua vim.lsp.buf.signature_help()<CR>", { buffer = true })
    set("n", "<space>wa", "<cmd>lua vim.lsp.buf.add_workspace_folder()<CR>", { buffer = true })
    set("n", "<space>wr", "<cmd>lua vim.lsp.buf.remove_workspace_folder()<CR>", { buffer = true })
    set("n", "<space>wl", "<cmd>lua print(vim.inspect(vim.lsp.buf.list_workspace_folders()))<CR>", { buffer = true })
    set("n", "<space>D", "<cmd>lua vim.lsp.buf.type_definition()<CR>", { buffer = true })
    set("n", "<space>rn", "<cmd>lua vim.lsp.buf.rename()<CR>", { buffer = true })
    set("n", "<space>ca", "<cmd>lua vim.lsp.buf.code_action()<CR>", { buffer = true })
    set("n", "gr", "<cmd>lua vim.lsp.buf.references()<CR>", { buffer = true })
    set("n", "<space>e", "<cmd>lua vim.lsp.diagnostic.show_line_diagnostics()<CR>", { buffer = true })
    set("n", "[d", "<cmd>lua vim.lsp.diagnostic.goto_prev()<CR>", { buffer = true })
    set("n", "]d", "<cmd>lua vim.lsp.diagnostic.goto_next()<CR>", { buffer = true })
    set("n", "<space>q", "<cmd>lua vim.lsp.diagnostic.set_loclist()<CR>", { buffer = true })
    set("n", "<space>f", "<cmd>lua vim.lsp.buf.formatting()<CR>", { buffer = true })
  end,
})

-- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š
require("mason").setup()
require("mason-lspconfig").setup()
require("mason-lspconfig").setup_handlers {
  function(server_name)
    require("lspconfig")[server_name].setup {}
  end,
}
```
ã“ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¾ã™ã€‚ã¾ãšã€ä¸ŠåŠåˆ†ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ã®è¨­å®šã§ã™ã€‚ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£è‡ªä½“ã¨ä¸Šã§èª¬æ˜ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
æ¬¡ã«`local on_attach`ã§å§‹ã¾ã‚‹è¡Œã§ã¯ã€LSPã‚µãƒ¼ãƒãƒ¼ãŒã‚¢ã‚¿ãƒƒãƒ(ã¤ã¾ã‚Švimã®ãƒãƒƒãƒ•ã‚¡ã¨ç´ä»˜ã‘ã‚‰ã‚Œã¦èµ·å‹•)ã—ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚ã“ã®ä¸­ã§ã¯LSPã‚µãƒ¼ãƒãƒ¼ã«é–¢ä¿‚ã™ã‚‹ã‚­ãƒ¼ãƒãƒƒãƒ—ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚ã“ã®è¨­å®šä¾‹ã§ã¯`K`ã§ã€Œãƒ›ãƒãƒ¼ã€ã€`gd`ã§ã€Œå®šç¾©ã¸ç§»å‹•ã€ãªã©ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“è‡ªåˆ†ãŒä½¿ã„ã‚„ã™ã„ã‚ˆã†ã«è‡ªç”±ã«å¤‰æ›´ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãã—ã¦æ®‹ã£ãŸéƒ¨åˆ†ã§ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¨­å®šã—ã¾ã™ã€‚ã“ã“ã§ã¯ã€`mason.nvim`ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸè¨€èªã‚µãƒ¼ãƒãŒè‡ªå‹•çš„ã«èµ·å‹•ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

ã§ã¯`init.lua`ã‚’æ›¸ã„ã¦ neovim ã‚’èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã™ã‚‹ã¨ã€lazy.nvimãŒè‡ªå‹•ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹ã¯ãšã§ã™ã€‚
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã«ã¯ã€`mason.nvim`ã«ã‚ˆã‚Š`:LspInstall [server name]`ã¨ã„ã†ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€`:Mason`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã“ã¨ã§ä¸‹å›³ã®ã‚ˆã†ã«ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”»é¢ã‚’ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
![](/images/blog/2021/08/neovim-lsp/mason.png)

ã§ã¯è©¦ã—ã«`:LspInstall lua_ls`ã‚’å®Ÿè¡Œã—ã¦Luaã®è¨€èªã‚µãƒ¼ãƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå¾Œã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã€ã—ã°ã‚‰ãã™ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã™ã€‚
å®Œäº†å¾Œã€ä¸€æ—¦Neovimã‚’å†èµ·å‹•ã—ã¦`init.lua`ã‚’é–‹ãã¨è‡ªå‹•ã§è¨€èªã‚µãƒ¼ãƒãŒèµ·å‹•ã™ã‚‹ã¯ãšã§ã™ã€‚LSPã«ã‚ˆã‚‹è¨ºæ–­ãŒè¡¨ç¤ºã•ã‚Œã€ä¸Šã§ã‚‚èª¬æ˜ã—ãŸã‚ˆã†ã«`K`ã§ãƒ›ãƒãƒ¼ã‚’å‡ºã™ã“ã¨ã‚‚ã§ãã¾ã™ã€‚
![](/images/blog/2021/08/neovim-lsp/lsp.png)

ä»–ã«ã‚‚ LSP çµŒç”±ã§ä½¿ãˆã‚‹æ©Ÿèƒ½ã¯ã“ã“ã§ã¯èª¬æ˜ã—ãã‚Œãªã„ã»ã©è±Šå¯Œã«ã‚ã‚Šã¾ã™ã€‚`:h lsp`ã«è©³ç´°ãªæƒ…å ±ãŒè¼‰ã£ã¦ã„ã‚‹ã®ã§èª­ã‚“ã§ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

## è£œå®Œ

ã“ã‚Œã§ LSP ã¯å‹•ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€è£œå®Œã‚’è¡Œã†ã«ã¯è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚Vim ã«ã¯æ§˜ã€…ãªè£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚Šã¾ã™ãŒã€LSP ã¸ã®å¯¾å¿œåº¦ãŒé«˜ã„[nvim-cmp](https://github.com/hrsh7th/nvim-cmp)ãŒãŠã™ã™ã‚ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã“ã‚Œã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

æœ¬ä½“ã¨ LSP ç”¨ã®è£œå®Œã‚½ãƒ¼ã‚¹ã§ã‚ã‚‹`cmp-nvim-lsp`ãŒåˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä¸¡æ–¹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚LSP ä»¥å¤–ã«ã‚‚æ§˜ã€…ãªè£œå®Œã‚½ãƒ¼ã‚¹ãŒé–‹ç™ºã•ã‚Œã¦ãŠã‚Šã€
ä¸‹ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ãƒãƒƒãƒ•ã‚¡ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è£œå®Œã—ã¦ãã‚Œã‚‹`cmp-buffer`ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚
ä»–ã«ã‚‚ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒãƒƒãƒ•ã‚¡ã®è£œå®Œã‚’ã—ã¦ãã‚Œã‚‹[cmp-cmdline](https://github.com/hrsh7th/cmp-cmdline)ãªã©ä¾¿åˆ©ãªã‚½ãƒ¼ã‚¹ãŒå¤šãã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€LSP ãŒã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è£œå®Œå€™è£œã¨ã—ã¦é€ã£ã¦ãã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã‚¹ãƒ‹ãƒšãƒƒãƒˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å®Ÿè³ªçš„ã«å¿…é ˆã§ã™ã€‚ã“ã“ã§ã¯[LuaSnip](https://github.com/L3MON4D3/LuaSnip)ã‚’ä½¿ã„ã¾ã™ã€‚

```lua :init.lua
-- lazy.nvimã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã«è¿½åŠ 
require("lazy").setup({
  { "L3MON4D3/LuaSnip" },

  { "hrsh7th/nvim-cmp" },
  { "hrsh7th/cmp-nvim-lsp" },
  { "hrsh7th/cmp-buffer" },
  { "saadparwaiz1/cmp_luasnip" },
}, {})

-- lspã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«è¨­å®š
capabilities = require("cmp_nvim_lsp").default_capabilities(),

-- lspã®è¨­å®šå¾Œã«è¿½åŠ 
vim.opt.completeopt = "menu,menuone,noselect"

local cmp = require"cmp"
cmp.setup({
  snippet = {
    expand = function(args)
      require("luasnip").lsp_expand(args.body)
    end,
  },
  mapping = cmp.mapping.preset.insert({
    ["<C-p>"] = cmp.mapping.select_prev_item(),
    ["<C-n>"] = cmp.mapping.select_next_item(),
    ["<C-d>"] = cmp.mapping.scroll_docs(-4),
    ["<C-f>"] = cmp.mapping.scroll_docs(4),
    ["<C-Space>"] = cmp.mapping.complete(),
    ["<C-e>"] = cmp.mapping.close(),
    ["<CR>"] = cmp.mapping.confirm({ select = true }),
  }),
  sources = cmp.config.sources({
    { name = "nvim_lsp" },
    { name = "luasnip" },
  }, {
    { name = "buffer" },
  })
})
```

ã“ã®ã‚ˆã†ã«è£œå®ŒãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼
![](/images/blog/2021/08/neovim-lsp/cmp.png)
### ä»–ã®è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³
`nvim-cmp`ä»¥å¤–ã«ã‚‚nvim-lspã§ä»•æ§˜ã§ãã‚‹è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã‚ã‚‹ã®ã§ã”ç´¹ä»‹ã—ã¾ã™ã€‚
- ddc.vim

https://github.com/Shougo/ddc.vim

[denops.vim](https://github.com/vim-denops/denops.vim)ã‚’ä½¿ã£ãŸè£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã€[nvim-lsp ã® source](https://github.com/Shougo/ddc-nvim-lsp)ã‚’å…¥ã‚Œã‚Œã° nvim-lsp ã§ã‚‚ä½¿ãˆã¾ã™ã€‚

- coq_nvim

https://github.com/ms-jpq/coq_nvim

coc.nvim ã«ä¼¼ã¦ã„ã¾ã™ãŒåˆ¥ç‰©ã§ã™ã€‚Python è£½ã§ã™ãŒ neovim å°‚ç”¨ã§ã™ã€‚

# ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿/ãƒªãƒ³ã‚¿

ã¤ã„ã§ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿/ãƒªãƒ³ã‚¿ã®è¨­å®šã‚‚ã—ã¦ã—ã¾ã„ã¾ã™ã€‚
neovim ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿/ãƒªãƒ³ã‚¿ã‚’å‹•ã‹ã™æ–¹æ³•ã¯ã„ã‚ã„ã‚ã‚ã‚Šã¾ã™ãŒã€ã“ã“ã§ã¯[none-ls](https://github.com/nvimtools/none-ls.nvim)ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚
ã“ã‚Œã¯æ§˜ã€…ãªãƒ„ãƒ¼ãƒ«ã®å‡ºåŠ›ã‚’ LSP ã®å½¢å¼ã«å¤‰æ›ã—ã¦ nvim-lsp ã«é€ã‚‹ã¨ã„ã†ä»•çµ„ã¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¼¼ãŸã‚ˆã†ãªãƒ„ãƒ¼ãƒ«ã«[diagnostic-languageserver](https://github.com/iamcco/diagnostic-languageserver)ã‚„[efm-langserver](https://github.com/mattn/efm-langserver)ãŒã‚ã‚Šã¾ã™ãŒã€`none-ls`ã¯Luaè£½ã®å¤–éƒ¨ä¾å­˜ãŒãªã„Neovimãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã‚ã‚‹ã“ã¨ãªã©ãŒåˆ©ç‚¹ã§ã™ã€‚
ã¾ãŸæ§˜ã€…ãªãƒªãƒ³ã‚¿ãƒ¼ï¼ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ç”¨ã«ã‚ã‚‰ã‹ã˜ã‚è¨­å®šãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã§ç°¡å˜ã«è¨­å®šã§ãã¾ã™ã€‚
è©³ã—ãã¯[null-ls ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/nvimtools/none-ls.nvim/blob/main/doc/BUILTINS.md)ã‚’è¦‹ã¦ãã ã•ã„ã€‚

ã“ã‚Œã¯ Prettier ã®è¨­å®šä¾‹ã§ã™ã€‚npm ã§ãƒ­ãƒ¼ã‚«ãƒ«ã«`prettier`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚Œã°ãã¡ã‚‰ãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãªã‘ã‚Œã°ã‚°ãƒ­ãƒ¼ãƒãƒ«ã®ã‚‚ã®ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
ã•ã‚‰ã«ã€å‰è¿°ã® mason.nvim ã§ prettier ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚mason.nvim ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®å®Ÿè¡Œå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ neovim ãŒèªè­˜ã™ã‚‹PATHã«åŠ ãˆã‚‹ãŸã‚ç‰¹åˆ¥ã«è¨­å®šã—ãªãã¦ã‚‚ä½¿ãˆã¾ã™ã€‚
ã¡ãªã¿ã« neovim ã®`:terminal`ã®ä¸­ã§ã‚‚ mason ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã¯ãƒ‘ã‚¹ãŒé€šã£ã¦ãŠã‚Šã€å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```lua :init.lua
{ "nvimtools/none-ls.nvim", dependencies = { "nvim-lua/plenary.nvim" }

local null_ls = require "null-ls"
null_ls.setup {
  sources = {
    null_ls.builtins.formatting.prettier.with {
      prefer_local = "node_modules/.bin",
    },
  },
}
```

ç™ºå±•çš„ãªè¨­å®šä¾‹ã§ã™ã€‚prettier ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã° prettier ã‚’ä½¿ã„ã€ãªã‘ã‚Œã°ä»£ã‚ã‚Šã«`deno fmt`ã‚’ä½¿ã„ã¾ã™ã€‚ã•ã‚‰ã«`deno`ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Œã° null-ls çµŒç”±ã®`deno fmt`ã§ã¯ãªã deno LSP ã®çµ„ã¿è¾¼ã¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä½¿ã„ã¾ã™ã€‚

```lua :init.lua
null_ls.setup {
  sources = {
    null_ls.builtins.formatting.deno_fmt.with {
      condition = function(utils)
        return not (utils.has_file { ".prettierrc", ".prettierrc.js", "deno.json", "deno.jsonc" })
      end,
    },
    null_ls.builtins.formatting.prettier.with {
      condition = function(utils)
        return utils.has_file { ".prettierrc", ".prettierrc.js" }
      end,
      prefer_local = "node_modules/.bin",
    },
  },
  capabilities = common_config.capabilities,
  on_attach = common_config.on_attach,
}
```

:::message
`prettier`ã¨åŒæ§˜ã«`eslint`ã‚‚ none-ls ã§ä½¿ç”¨ã§ãã¾ã™ãŒã€ã™ã”ãé‡ã„ã®ã§`eslint-lsp`ã‚’ä½¿ã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚mason.nvim ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¾ã™ã€‚
:::

# ã„ã‚ã„ã‚ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³é”

ã“ã“ã¾ã§ã§åŸºæœ¬çš„ãªè¨­å®šã¯å®Œäº†ã§ã™ãŒã€LSP ã¨é€£æºã—ã¦é–‹ç™ºã‚’ã‚ˆã‚Šä¾¿åˆ©ã«ã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ã¾ãŸã€[ã“ã¡ã‚‰ã®ãƒªã‚¹ãƒˆ](https://github.com/yutkat/my-neovim-pluginlist/blob/main/lsp.md)ãŒã‹ãªã‚Šç¶²ç¾…çš„ã§ LSP é–¢é€£ä»¥å¤–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ¢ã™æ™‚ã«ã‚‚ä¾¿åˆ©ã§ã™ã€‚
ã“ã®ãƒªã‚¹ãƒˆã®ä½œæˆè€…ã•ã‚“ã®è¨˜äº‹ã‚‚ã‚ã‚Šã¾ã™ã®ã§ã“ã¡ã‚‰ã‚‚ã©ã†ãã€‚

https://zenn.dev/yutakatay/articles/neovim-pluginlist

## LSP æ‹¡å¼µç³»

- lsp_signature.nvim

  https://github.com/ray-x/lsp_signature.nvim

  é–¢æ•°ã®å¼•æ•°ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹ã¨ãã«ã‚·ã‚°ãƒãƒãƒ£ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚

- lspkind-nvim

  https://github.com/onsails/lspkind-nvim

  è£œå®Œã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ã—ã¦ãã‚Œã¾ã™ã€‚

- fidget.nvim

  https://github.com/j-hui/fidget.nvim

  è¨€èªã‚µãƒ¼ãƒã®ç¨¼åƒçŠ¶æ³ãªã©ã‚’è¡¨ç¤ºã—ã¦ãã‚Œã‚‹ã‚„ã¤ã§ã™ã€‚VSCodeã®å³ä¸‹ã«å‡ºã¦ã„ã‚‹ã‚‚ã®ã‚’å†ç¾ã§ãã¾ã™ã€‚

- noice.nvim

  https://github.com/folke/noice.nvim

  neovim ã® UI å…¨èˆ¬ã‚’é­”æ”¹é€ ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚lsp_signature.nvim ã¨ fidget.nvim ã‚’ç½®ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ç‰¹å®šã®è¨€èªç”¨ã®ã‚„ã¤

rust-analyzer ã«ãŠã‘ã‚‹`experimental/externalDocs`(docs.rs ã‚’é–‹ãæ©Ÿèƒ½)ã®ã‚ˆã†ã«ã€è¨€èªã‚µãƒ¼ãƒã¯ãã‚Œãã‚Œ LSP ã®æ¨™æº–ã«ã¯ãªã„ç‹¬è‡ªã®ä»•æ§˜ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
å½“ç„¶ãã‚Œã‚‰ã¯ nvim-lsp ã§ã¯æ‰±ãˆãªã„ã®ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚
ãã®ä»–ã«ã‚‚ LSP ã§ã¯æ‰±ã„ãã‚Œãªã„ã‚ˆã†ãªã‚‚ã®ãŒã„ã‚ã„ã‚ã‚ã£ãŸã‚Šã™ã‚‹ã®ã§ãã‚Œã‚’æ‰±ã£ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä»¥ä¸‹ã§ç´¹ä»‹ã—ã¾ã™ã€‚

- typescript.nvim

  https://github.com/jose-elias-alvarez/typescript.nvim

- rust-tools.nvim

  https://github.com/simrat39/rust-tools.nvim

- go.nvim

  https://github.com/ray-x/go.nvim

- nvim-jdtls

   https://github.com/mfussenegger/nvim-jdtls


- flutter-tools.nvim

  https://github.com/akinsho/flutter-tools.nvim

# å‚è€ƒã«ãªã‚‹ã‚µã‚¤ãƒˆ

- å…¬å¼ã® LSP ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

  https://neovim.io/doc/user/lsp.html

- r/neovim

  https://www.reddit.com/r/neovim/

  æµ·å¤–ã®å·¨å¤§æ²ç¤ºæ¿ Reddit ã® neovim subreddit ã§ã™ã€‚æ–°ã—ã„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã‚ˆãã“ã“ã§å®£ä¼ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»–ã«ã‚‚ã„ã‚ã„ã‚ãª neovim ã®æœ€æ–°æƒ…å ±ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- Github ã® dotfiles ãƒªãƒã‚¸ãƒˆãƒªé”

  ã„ã‚ã‚“ãªäººãŒè‡ªåˆ†ã®å¥½ã¿ã® neovim ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’ä½œã£ã¦ Github ã‚„ã‚‰ã«ä¸Šã’ã¦ã„ã¾ã™(Github ã§`nvim`ã¨ã‹æ¤œç´¢ã™ã‚Œã°ãŸãã•ã‚“ã§ã¦ãã¾ã™)ã€‚å‚è€ƒã«ãªã‚‹è¨­å®šãŒæ²¢å±±ã‚ã‚‹ã®ã§è©°ã¾ã£ãŸã‚Šã—ãŸã‚‰è¦‹ã¦ã¿ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚

- https://neovim-mine.vercel.app/

  æ‰‹å‰å‘³å™Œã§ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ãŒã€Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¦‹ã¤ã‘ã‚„ã™ãã™ã‚‹ã‚µã‚¤ãƒˆã‚’ä½œã£ãŸã®ã§ç´¹ä»‹ã—ã¦ãŠãã¾ã™ã€‚
  å…ˆã»ã©ã‚‚æŒ™ã’ãŸ https://github.com/yutkat/my-neovim-pluginlist ã¨[Awesome Neovim](https://github.com/rockerBOO/awesome-neovim)ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã•ã›ã¦ã‚‚ã‚‰ã„ã€è¦‹ã‚„ã™ã„å½¢(å€‹äººã®æ„Ÿæƒ³)ã«ã¾ã¨ã‚ãŸã‚µã‚¤ãƒˆã§ã™ã€‚

# æœ€å¾Œã«

ã“ã®è¨˜äº‹ã§ã‚„ã£ãŸè¨­å®šã‚’ã‚’ã¾ã¨ã‚ã¦ãŠãã¾ã—ãŸã€‚ã‚³ãƒ¡ãƒ³ãƒˆã¨ã‹ã‚‚æ›¸ãåŠ ãˆã¦ã‚ã‚Šã¾ã™ã€‚

https://github.com/nazo6/zenn/blob/main/examples/c2f16b07798bab/init.lua

ã¤ã„ã§ã«è‡ªåˆ†ã® neovim ã®è¨­å®šã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚ã‚ˆã‘ã‚Œã°å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

https://github.com/nazo6/nvim

ãã‚Œã§ã¯ã‚ˆã„ neovim ãƒ©ã‚¤ãƒ•ã‚’ã€‚


> ã“ã®è¨˜äº‹ã¯ [https://note.nazo6.dev/blog/c2f16b07798bab](https://note.nazo6.dev/blog/c2f16b07798bab) ã¨ã®ã‚¯ãƒ­ã‚¹ãƒã‚¹ãƒˆã§ã™ã€‚