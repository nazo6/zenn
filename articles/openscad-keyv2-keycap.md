---
published: true
type: tech
topics:
  - Keyboard
emoji: ⌨️
title: OpenSCADとKeyV2でキーキャップを作る
---
# はじめに
[OpenSCAD](https://openscad.org)は専用のプログラミング言語を用いてモデリングを行うことができるCADソフトです。CADとは言っても他のCADとは一線を画しており、グラフィカルにマウスを操作してモデリングを行うわけではなく、専用のプログラミング言語を用いてモデリングを行います。これにより宣言的に3Dモデルを記述できるようになり、優れた再利用性や手作業の曖昧さの排除などの利点を得られます。

このようにOpenSCADはCADであるだけではなくプログラミング言語であり、ライブラリを読み込むことができます。その一つがキーキャップ生成用ライブラリである[KeyV2](https://github.com/rsheldiii/KeyV2)です。これを用いると非常に簡単にキーキャップを生成できます。
残念ながら現在は開発が停止しているようですが、十分使うことができます。
# 使用した環境
- OS: Windows (OpenSCADはmacやLinuxでも動きます)
- バージョン: OpenSCAD-2024.11.08
- 3Dプリンター: Bambu Lab A1
- スライサー: Bambu Studio

# 準備
まず、OpenSCADをインストールします。ダウンロードページは

https://openscad.org/downloads.html

で、下の方にあるDevelopment Snapshotsをインストールしてください。

Windowsでscoopをお使いの方は
```
scoop bucket add versions
scoop install openscad-dev
```
でインストールすることもできます。

インストールできたら一度OpenSCADを開いて`New`ボタンより一度OpenSCADのメイン画面を開いた後、`Edit -> Preferences`の`Advanced`タブより、`Backend`のプルダウンメニューが初期では`CGAL`になっているのを`Manifold`に変えてください。これをしないとうまく動きませんでした。

では次にKeyV2を準備します。お好きなディレクトリで
```
git clone https://github.com/rsheldiii/KeyV2/
```
を実行し、KeyV2をダウンロードします。今後作成するファイルではこのフォルダの中にあるファイルをインクルードして使います。ここでは、
```
KeyV2/
| src/
| ...
└ README.md
my-keycap
│ keycap1.scad
| ...
└ keycap10.scad
```
のようなフォルダ構成とします。

# キーの作成
では、キーキャップを生成してみましょう。`my-keycap/keycap1.scad`(名前はなんでもいいですが先程示したようにKeyV2の親ディレクトリに置いてください)を作成し、OpenSCADで開きます。

開けたら左側のエディタに
```openscad
include <../KeyV2/includes.scad>

cherry_row(1) key();
```

と入力して、F5を押してください。すると、このようにキーキャップのプレビューが表示されるはずです。
![](/images/blog/2024/11/openscad/keycap1.png)
非常に簡単ですね。

ちなみに、`Design -> Automatic Reload Preview`を有効にするとセーブ時に自動でプレビューを行ってくれます。

## エクスポート
エクスポートするには、まずF6を押してください。これによりレンダリングが行われます。その後`File -> Export`から好きな形式でエクスポートすることができます。
# カスタマイズ
KeyV2ではここからさらに色々なカスタマイズを行うことができます。
## プロファイル
先程のコードには`cherry_row(1)`とありましたが、これはプロファイル名と列から形を決めています。他のプロファイルも多数用意されており、[ここ](https://github.com/rsheldiii/KeyV2/tree/master/src/key_profiles)でその一覧を見ることができます。これを適用するには、例えばDSAプロファイルであれば`dsa_row(1)`のように変更するだけです。
## ステム
先程生成したキーキャップのステムは以下のようになっていると思います。
![](/images/blog/2024/11/openscad/stem.png)
この形はMXスイッチの穴にちょうどハマるようにできているのですが、誤差が中々シビアで自分が持っているFDM方式のプリンターだとスイッチにはまりませんでした。そこで、ステムを丸型のものに変更してみます。先程の`key()`で終わる行を以下のようにします。
```
cherry_row(1) no_stem_support() bar_support() rounded_cherry() key();
```
これで、ステムが以下のような丸型のものに変わったはずです。
![](/images/blog/2024/11/openscad/stem_round.png)
これは`rounded_cherry()`によるものです。また`no_stem_support()`でステム下部のサポートを消し、`bar_support()`で上部のバーによるサポートを追加しています。 

また、`rounded_cherry()`の他にも`choc()`が用意されており、chocスイッチ用のキーキャップを作ることもできます。`low_profile()`という関数もあるのでこれを使うと良いでしょう。

## 刻印
`legend("str")`を使うことで刻印を印字できます。文字の他に位置、文字サイズやフォントを指定することがけいます。
また、`front_legend`を用いるとキー前面にも印字できます。

以下の例では、[Nerd Font](https://github.com/ryanoasis/nerd-fonts/blob/master/readme_ja.md)をサポートするフォントを指定することで、上面にはWindowsのロゴ、前面にはWinと表示するようなキーキャップを作成しています。

コード:
```
include <../KeyV2/includes.scad>

cherry_row(1) 
  legend("", position=[-1,-1],size=3,font="PlemolJP Console NF") 
  front_legend("Win", size=2) 
  key();
```
プレビュー:
![](/images/blog/2024/11/openscad/legend.png)

## 他の細かなカスタマイズ
あらかじめ用意されている関数を使用するだけではなく、パラメータを上書きすることで細かなチューニングができます。

https://github.com/rsheldiii/KeyV2/blob/19f0d2faadd4949634c93f38d1a66869d29e8f43/src/settings.scad

上のソースコード中に設定一覧が定義されているので細かいカスタマイズをしたい時はこの変数を弄ります。例えばキーキャップの高さを少し低くしたいといった時はこのようなコードを書くことができます。
```
cherry_row(1) {
  $total_depth = $total_depth - 1;
  key();
}
```
# 積層式3Dプリンターでの印刷のコツ
このようにしてできたキーキャップのモデルですが、光造形の3Dプリンターであればかなり綺麗に印刷できるようです。しかし、生憎と筆者は積層式しか持っていません。

積層式は光造型ほど綺麗にはできないため、前述のようにステムを変えるなど若干の工夫が必要です。本節では、以下の詳しく調べてくれているブログを参照しながら自分で試してみて分かったコツを記載します。

https://candrews.integralblue.com/2024/03/3d-printing-high-quality-keycaps/
## ポイント
### 1. ステムの形状を丸にする
これは上の項目で書いた通りです。これじゃないと入りません。
### 2. 印刷時は角度を付ける
普通にキーキャップを置いた時のような角度で印刷すると、ステムと本体の接着が弱くなる他、キーキャップ上部の窪みになっている部分で非常に積層痕が目立ちます。

斜めに印刷することにより、これを解消できます。上の記事では45度を推奨しており、確かに45度が一番綺麗に印刷できますが、20度程度であってもまったく角度を付けないのとは大部違うと思います。
#### 傾ける方向について
印刷物に角度を付けるには、
- 指を置く向きに沿った方向
   ![](/images/blog/2024/11/openscad/rot_h.png)
- 指の向きに垂直な方向
   ![](/images/blog/2024/11/openscad/rot_v.png)
の二種類が考えられます。
(画像が分かりづらいかもしれませんが、この2つは両方とも同じ向きから見ており、モデルの回転方向が違います)

指の向きに垂直な方向だと指を前後に滑らせた時に滑らかな良い感触になります(そのためか、実際上のブログで配布されているモデルもそのようになっています)が、造形精度によってはステム部分に左右で高さに差が出来てしまい、スイッチにはめた時になんだか若干傾いてしまうことがあるという問題があります。

一方、沿った方向の傾きは全く逆です。滑りがザラザラしますが、左右に差ができることはありません。

個人的にはザラザラでも特に不満はないので沿った方向にしています。
### 3. サポートの設定
斜めにするとサポートが必要になってきますが、以下のような設定が個人的には良いのではないかと思います。
![](/images/blog/2024/11/openscad/support.png)
- サポートタイプはツリー 
- サポートのスタイルはTree Organic。これにするとツリーが全て底面で繋がり、とても剥がしやすいです。
- サポートの閾値角度はプリンター等によって変わってくると思います。上図ではキーキャップを30度傾けましたが、閾値25度でもダレたすることは特にありませんでした。

### 4. 0.2mmノズルに変える
これはまだ試せていないのですが、0.2mmノズルは細かいものがとても綺麗に印刷できるようなので今度ノズルを買って試したいです。

> この記事は [https://note.nazo6.dev/blog/openscad-keyv2-keycap](https://note.nazo6.dev/blog/openscad-keyv2-keycap) とのクロスポストです。