---
published: true
type: idea
topics:
  - typescript
  - vim
  - neovim
emoji: ğŸ“™
title: Typescriptã§neovimã®è¨­å®šã‚’æ›¸ãï¼
---


vim ã‚’ä½¿ã„å§‹ã‚ã¦ 2 é€±é–“ã»ã©ãŸã£ãŸã‚ã‚‹æ—¥ã€ã›ã£ã‹ã neovim ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚“ã ã—è¨­å®šãŒå°‘ãªã„ä»Šã®ã†ã¡ã« init.vim ã‚’ init.lua ã«æ›¸ãæ›ãˆã‚ˆã†ã¨æ€ã„[ã“ã¡ã‚‰](https://github.com/willelz/nvim-lua-guide-ja/blob/master/README.ja.md)ã®æ–‡ç« ã‚’èª­ã‚“ã§ã„ãŸã¨ã“ã‚ã€æœ€å¾Œã«ã“ã‚“ãªã‚‚ã®ãŒã‚ã‚‹ã®ã«æ°—ã¥ãã¾ã—ãŸã€‚

> ãã®ä»–ã®èˆˆå‘³æ·±ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ:
> [TypeScriptToLua/TypeScriptToLua](https://github.com/TypeScriptToLua/TypeScriptToLua)

ã“ã‚Œã¯ã‚‚ã—ã‹ã—ã¦ Typescript ã§ vim ã®è¨­å®šãŒæ›¸ã‘ã‚‹ã®ã§ã¯ãªã„ã‹ã¨ã„ã†ã“ã¨ã§ã‚„ã£ã¦ã¿ãŸã¨ã„ã†è©±ã§ã™ã€‚




# å°å…¥

neovim ã® config å†…ã«æ–°ã—ã ts ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ã¦ãã“ã« Typescript é–¢é€£ã®è«¸ã€…ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚ã¡ãªã¿ã«è‡ªåˆ†ã®ç’°å¢ƒã¯ Win10 ã§ã™ãŒã„ã‚ã„ã‚é•ã†ã¨ã“ã‚ãŒã‚ã‚‹ã¨æ€ã†ã®ã§é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚ã‚ã¨å€‹äººçš„ã«[pnpm](https://pnpm.js.org)ã‚’æ¨ã—ã¦ã„ã‚‹ã®ã§ä½¿ã£ã¦ã„ã¾ã™ãŒãã‚Œã‚‚é©å®œèª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚

```
$ mkdir ts
$ cd ts
$ pnpm init -y
$ pnpm i -D typescript-to-lua lua-types
```

npm scripts ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json
"scripts": {
  "build": "tstl",
  "dev": "tstl --watch"
}
```

# å®Ÿè¡Œã—ã¦ã¿ã‚‹

ã¾ãšã¯ tsconfig.json ã‚’ä½œã‚Šã¾ã™ã€‚TypescriptToLua ã§ã¯å¤šãã® tsconfig ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¦ã•ã‚‰ã«å›ºæœ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚å­˜åœ¨ã—ã¾ã™ã€‚

```json:ts/tsconfig.json
{
  "compilerOptions": {
    "target": "esnext",
    "lib": [
      "esnext", "DOM"
    ],
    "moduleResolution": "node",
    "strict": true,
    "rootDir": "./src",
    "outDir": "../lua",
    "types": [
      "lua-types/5.3"
    ]
  },
  "tstl": {
    "luaTarget": "JIT",
    "noImplicitSelf": true
  }
}
```

ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ src ä»¥ä¸‹ã«å…¥ã‚Œã‚‹ã¤ã‚‚ã‚Šãªã®ã§ rootDir ã‚’è¨­å®šã—ã¾ã™ã€‚ã¾ãŸ neovim ã¯ lua ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹ lua ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§èª­ã¿è¾¼ã‚€ã®ã§ãã“ã« lua ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

æ¬¡ã«ã€ã¨ã‚Šã‚ãˆãš ts ç”¨ã®ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ src/tsinit.ts ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```ts:ts/src/tsinit.ts
console.log("Hello world from ts!");
```

`pnpm dev`ã‚’å®Ÿè¡Œã™ã‚Œã° tsc ã¨åŒã˜ã‚ˆã†ã«ä¿å­˜ã—ãŸã‚‰è‡ªå‹•ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ãã‚Œã¾ã™ã€‚

æœ€å¾Œã«ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸ tsinit.lua ã‚’å‘¼ã³å‡ºã™ã ã‘ã® init.lua ã‚’ä½œã‚Šã¾ã™ã€‚

```lua:init.lua
require("tsinit")
```

ã¨ã¦ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§ã„ã„ã§ã™ã­ã€‚ã§ã¯ã“ã“ã§ neovim ã‚’èµ·å‹•ã—ã¾ã™ã€‚

> Hello world from ts!

ã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰æˆåŠŸã§ã™ã€‚
ã€€ã¡ãªã¿ã«ã“ã“ã§ã¯ ts ãŒä½¿ãˆã‚‹ã¨ã„ã†ã“ã¨ã‚’ç¤ºã™ãŸã‚ã« console.log ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒ tstl ãŒã„ã„æ„Ÿã˜ã«å¤‰æ›ã—ã¦ãã‚Œã¦ã„ã‚‹ã®ã§å‹•ãã¾ã™ãŒã“ã†ã„ã£ãŸå¯¾å¿œãŒã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯ã‚ã¾ã‚Šãªã„ã®ã§ lua ã‚„ vim ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ãŸæ–¹ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚

# vim ã®è¨­å®šã‚’æ›¸ã

ã•ã¦ã€ã“ã‚Œã§ TS ã§ vim ã®è¨­å®šãŒæ›¸ã‘ã‚‹ã“ã¨ã¯ã‚ã‹ã‚Šã¾ã—ãŸãŒæ¬¡ã« vim ã®è¨­å®šã‚’ã—ã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¨ã„ã£ã¦ã‚‚ä½•ã‚‚è€ƒãˆãªãã¦ã‚‚ lua ã¨åŒã˜é€šã‚Šã«æ›¸ã‘ã°å‘¼ã³å‡ºã›ã¾ã™ã€‚
ã¨ã„ã†ã‚ã‘ã§ã¨ã‚Šã‚ãˆãšã„ãã¤ã‹è¨­å®šã—ã¦ã¿ã¾ã—ãŸ

```ts:ts/src/tsinit.ts
console.log("Hello world from ts!");

vim.api.nvim_set_option("number", true);

vim.api.nvim_set_option("tabstop", 2);
vim.api.nvim_set_option("shiftwidth", 2);
vim.api.nvim_set_option("expandtab", true);

vim.api.nvim_set_option("clipboard", "unnamedplus");
```

ã§ã¯å®Ÿè¡Œã—ã¦ã¿ã¾ã™
...
ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã—ãŸã­ã€‚vim ãªã‚“ã¦ã‚‚ã®ã¯å­˜åœ¨ã—ãªã„ã‚“ã§ã™ã‹ã‚‰å½“ç„¶ã§ã™ã­ã€‚
ã¨ã‚Šã‚ãˆãšã“ã“ã§ã¯å‹å®šç¾©ã‚’ä½œæˆã—ã¦ã—ã®ãã¾ã™ã€‚

```ts:ts/@types/vim.d.ts
declare namespace vim {
  const api: {
    [key: string]: (...args: any[]) => any;
  };
}
```

ã“ã‚Œã§å•é¡Œãªããƒ“ãƒ«ãƒ‰ãƒ»å®Ÿè¡Œã§ãã‚‹ã¯ãšã§ã™

# å‹ã‚’ã¤ã‘ãŸã„

ã“ã“ã¾ã§ã§ä¸€å¿œ Typescript ã§ neovim ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’æ›¸ãã“ã¨ã¯ã§ãã‚‹ã¨åˆ†ã‹ã£ã¦ã‚‚ã‚‰ãˆãŸã‹ã¨æ€ã„ã¾ã™ã€‚ã—ã‹ã—ã¾ã è¶³ã‚Šãªã„ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚ãã†ã€å‹ã§ã™ã€‚Typescript ãªã‚‰å‹å®‰å…¨ã«é–‹ç™ºã—ãŸã„ã‚‚ã®ã§ã™ã€‚ã¨ã„ã£ã¦ã‚‚å‹å®šç¾©ãªã‚“ã¦ã‚ã‚‹ã¯ãšãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¨ã„ã†ã‚ã‘ã§è‡ªåˆ†ã§ä½œã‚Šã¾ã—ãŸã€‚
https://github.com/nazo6/nvim-types
neovim ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰åŠè‡ªå‹•ã§å‹å®šç¾©ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
ãªã®ã§ã™ãŒå®Ÿã¯å‹å®šç¾©ã¯ã§ãã¦ãŠã‚‰ãšã€é–¢æ•°åã¨ JSDoc ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹è©³ç´°ã®è¡¨ç¤ºã«ã¨ã©ã¾ã£ã¦ã„ã¾ã™ãƒ»ãƒ»ãƒ»ã¾ã‚ã—ã‹ã—ãã‚Œã§ã‚‚ã“ã‚Œã§ã ã„ã¶æ¥½ã«ãªã‚‹ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

ã¨ã‚‚ã‹ã nvim-types ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
$ pnpm i -D nvim-types
```

ã“ã®ã¾ã¾ã§ã¯ Typescript ãŒå‹å®šç¾©ã‚’èªè­˜ã—ã¦ãã‚Œãªã„ã®ã§ tsconfig ã§æŒ‡å®šã—ã¦ã‚ã’ã¾ã™ã€‚

```json
"types": ["lua-types/5.3", "nvim-types/0.5.0-nightly"]
```

ã“ã‚Œã§ vim api ã®å‹ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚ã“ã‚“ãªæ„Ÿã˜ã§è£œå®Œã‚‚åŠ¹ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚(any ã§ã™ãŒãƒ»ãƒ»ãƒ»)
![](https://storage.googleapis.com/zenn-user-upload/06ux5lrkppt0av3359iu3r7322y1)

ã“ã“ã¾ã§ã‚„ã£ã¦ã»ã‹ã«ã‚‚ã„ã‚ã„ã‚è¨­å®šã—ã¦ã‚‹è‡ªåˆ†ã®è¨­å®šãƒ•ã‚©ãƒ«ãƒ€ãŒã“ã¡ã‚‰ã«ãªã‚Šã¾ã™ã€‚
https://github.com/nazo6/nvim/tree/81900fa3afccf21bdd6c68934aeb964a00137adf
dein ã®è¨­å®šã¨ã‹ã‚‚ã‚ã‚‹ã®ã§å°‘ã—ã¯å½¹ã«ç«‹ã¤ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚

# èª²é¡Œ

- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã‹ã¯å‹ãŒåŠ¹ã‹ãªã„
- ã¾ã‚å‹ã¯æ›¸ã‘ã°ã„ã„ã®ã§ã™ãŒ TypescriptToLua ã®ä»•æ§˜ä¸Šã©ã†ã—ã¦ã‚‚`.`ã§ã¯ãªã`:`ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã¨ã“ã‚ãŒå‡ºã¦ãã¦ã—ã¾ã„ã†ã¾ãå‹•ã‹ãªããªã‚Šã¾ã™ã€‚`@noSelf`ã§å›é¿ã§ãã‚‹ã®ã§ã™ãŒå‹ã«ã‚ˆã£ã¦ã¯ã†ã¾ãã„ã‹ãªãã¦è‹¦åŠ´ã—ã¦ã„ã¾ã™ã€‚
- ãƒ“ãƒ«ãƒ‰ãŒã‚ã‚“ã©ãã•ã„ã€‚ãƒ“ãƒ«ãƒ‰ã—å¿˜ã‚Œã¦ã‚ã‚Œï¼Ÿå‹•ã‹ãªã„ã¨ã„ã†ã“ã¨ãŒã‚ˆãã‚ã‚‹ã€‚tstl ã‚’ neovim ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å‹•ã‹ã—ã¦ã‚‹ã¨è¨­å®šåæ˜ ã®å†èµ·å‹•ã§æ¶ˆãˆã‚‹
- ã“ã“ã¾ã§ã—ã¦ Typescript ã§æ›¸ãæ„å‘³ã£ã¦ãƒ»ãƒ»ãƒ»ï¼Ÿï¼ˆãŠã„

# æœ€å¾Œã«

ã¨ã„ã†ã‚ã‘ã§ neovim ã®è¨­å®šã‚’ Typescript ã§æ›¸ãæ–¹æ³•ã«ã¤ã„ã¦æ›¸ã„ã¦ãã¾ã—ãŸã€‚åŒã˜ä»•çµ„ã¿ã§ neovim å‘ã‘ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã‚‚ã§ãã‚‹ã¯ãšã§ã™(ã‚„ã£ãŸã“ã¨ãªã„ã‘ã©)ã€‚ã¾ãŸä»–ã«ã‚‚ lua ã«å¤‰æ›ã§ãã‚‹è¨€èªã¯ã™ã¹ã¦ neovim ã®è¨­å®š/ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒæ›¸ã‘ã‚‹ã¯ãšã§ã™ã€‚
ã€€ã¡ãªã¿ã« nvim-types ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‹ã‚‰ã‹ãªã‚Šç„¡ç†ã‚’ã—ã¦æƒ…å ±ã‚’ã¨ã£ã¦ãã¦ã„ã‚‹ã®ã§ã‚‚ã£ã¨ä½•ã‹ã„ã„æ–¹æ³•ã‚’è€ƒãˆãŸã„ãªãƒ¼ã¨æ€ã£ã¦ã„ã¾ã™(ä»Šè€ƒãˆã¦ã„ã‚‹ã®ã¯ neovim ã®ã‚½ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æŒã£ã¦ãã‚‹ã“ã¨ã€‚ã ãŒãã‚Œã‚‚ vim.api ä»¥ä¸‹ã®ã¿)ã€‚æµçŸ³ã«æ‰‹å‹•ã§ã¯ã‚„ã‚ŠãŸããªã„ã§ã™ãƒ»ãƒ»ãƒ»

vimscript ã¯ã¨ã£ã¤ãã¥ã‚‰ã„ã¨ã“ã‚ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ vim ã„ãªã¨æ€ã„ã¾ã™ã€‚


> ã“ã®è¨˜äº‹ã¯ [https://note.nazo6.dev/blog/6e0fa6b331f2e5](https://note.nazo6.dev/blog/6e0fa6b331f2e5) ã¨ã®ã‚¯ãƒ­ã‚¹ãƒã‚¹ãƒˆã§ã™ã€‚